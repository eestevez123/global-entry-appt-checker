<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Global Entry Appointment Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
  <body>
    <div class="container">
      <h1>Global Entry Appointment Tracker</h1>
      <p><strong>Alert threshold:</strong> Appointments before <span style="color: red">{{ threshold_date.strftime('%B %d, %Y') }}</span></p>
      <form id="refreshForm" method="POST" action="/refresh">
        <button type="submit" id="refreshBtn">üîÅ Refresh Now</button>
        <span id="loading" style="display: none;">‚è≥ Checking...</span>
      </form>
      <script>
        const form = document.getElementById("refreshForm");
        const btn = document.getElementById("refreshBtn");
        const loading = document.getElementById("loading");
      
        form.addEventListener("submit", () => {
          btn.disabled = true;
          loading.style.display = "inline";
        });
      </script>    
      <table>
        <tr>
          <th>Location</th>
          <th>Earliest Appointment</th>
        </tr>
        {% for name, dt in slots.items() %}
        <tr>
          <td>{{ name }}</td>
          <td>{{ dt.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="2">No data yet</td>
        </tr>
        {% endfor %}
      </table>
      <p style="margin-top: 20px; font-size: 0.9em; color: gray;">
        Last refreshed: {{ now().strftime('%Y-%m-%d %I:%M:%S %p %Z') }}
      </p>
    </div>
  </body>
</html>
