<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Global Entry Appointment Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
  <body>
    <div class="container">
      <h1>Global Entry Appointment Tracker</h1>
      {% if not alerts_enabled %}
        <div style="background: #e6ffe6; padding: 1rem; border-left: 5px solid #4CAF50; margin-bottom: 1rem; border-radius: 6px;">
          <strong>üéâ Mission accomplished!</strong><br>
          I've already booked my Global Entry appointment.<br>
          This tool served its purpose ‚Äî check out the source code 
          <a href="https://github.com/eestevez123/global-entry-appt-checker" target="_blank" style="color: #0077cc; font-weight: bold;">on GitHub</a>.
        </div>
      {% endif %}
      <p><strong>Alert threshold:</strong> Appointments before <span style="color: red">{{ threshold_date.strftime('%B %d, %Y') }}</span></p>
      <form id="refreshForm" method="POST" action="/refresh">
        <button type="submit" id="refreshBtn">üîÅ Refresh Now</button>
        <span id="loading" style="display: none;">‚è≥ Checking...</span>
      </form>
      <script>
        const form = document.getElementById("refreshForm");
        const btn = document.getElementById("refreshBtn");
        const loading = document.getElementById("loading");
      
        form.addEventListener("submit", () => {
          btn.disabled = true;
          loading.style.display = "inline";
        });
      </script>    
      <table>
        <tr>
          <th>Location</th>
          <th>Earliest Appointment</th>
        </tr>
        {% for name, info in slots.items() %}
        <tr>
          <td>{{ name }}</td>
          <td>
            {% if info.status == "available" %}
              <span style="color: green;">
                {{ info.date.strftime('%B %d, %Y at %I:%M %p') }}
              </span>
            {% elif info.status == "full" %}
              <span style="color: #888;">
                Appointments full through {{ info.date.strftime('%B %d, %Y') }}
              </span>
            {% else %}
              <span style="color: red;">Unknown status</span>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="2">No data yet</td>
        </tr>
        {% endfor %}
      </table>
      <p style="margin-top: 20px; font-size: 0.9em; color: gray;">
        Last refreshed: {{ now().strftime('%Y-%m-%d %I:%M:%S %p %Z') }}
      </p>
    </div>
  </body>
</html>
